# ğŸš€ ì‹ ê·œ ì„œë¹„ìŠ¤ ê°œë°œ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” ì£¼ì‹ ë¶„ì„ ì‹œìŠ¤í…œì— ìƒˆë¡œ ì¶”ê°€ëœ 3ê°œ ì„œë¹„ìŠ¤ì˜ ê¸°ëŠ¥ ê°œë°œì„ ìœ„í•œ ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

**ğŸ¯ ê°œë°œ ëŒ€ìƒ ì„œë¹„ìŠ¤:**

1. **Issue Scheduler Service** (í¬íŠ¸ 8007) - ê¸°ì—… ì´ìŠˆ ì¼ì • ê´€ë¦¬
2. **Business Report Service** (í¬íŠ¸ 8008) - ì‚¬ì—…ë³´ê³ ì„œ AI ìš”ì•½
3. **Analysis Service** (í¬íŠ¸ 8009) - ì£¼ê°€ ì›ì¸ ë¶„ì„ (ê¸°ëŠ¥ ë³´ì™„)

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì´í•´

### **í˜„ì¬ êµ¬í˜„ ìƒíƒœ**

- âœ… **API ì—”ë“œí¬ì¸íŠ¸**: ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡° ì™„ì„±
- âœ… **ì„œë¹„ìŠ¤ í†µí•©**: API Gateway, ì‹œìŠ¤í…œ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ ì—°ë™ ì™„ë£Œ
- âœ… **ê¸°ë³¸ êµ¬ì¡°**: FastAPI, ê³µí†µ ëª¨ë“ˆ import, ë¡œê¹…, CORS ì„¤ì • ì™„ë£Œ
- â³ **ì‹¤ì œ ê¸°ëŠ¥**: TODO ì£¼ì„ìœ¼ë¡œ êµ¬í˜„ ê°€ì´ë“œ ì œê³µ (ê°œë°œ í•„ìš”)

### **ê³µí†µ ê¸°ìˆ  ìŠ¤íƒ**

```python
# í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
- FastAPI: REST API ì„œë²„
- uvicorn: ASGI ì„œë²„
- aiohttp: ë¹„ë™ê¸° HTTP í´ë¼ì´ì–¸íŠ¸
- MySQL: ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤
- ChromaDB: ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤
- LLM Manager: ë‹¤ì¤‘ LLM ì§€ì› (HyperCLOVA, ChatGPT ë“±)
```

### **ê³µí†µ ëª¨ë“ˆ í™œìš©**

```python
# ì´ë¯¸ importë˜ì–´ ìˆëŠ” ê³µí†µ ëª¨ë“ˆë“¤
from shared.database.mysql_client import MySQLManager
from shared.llm.llm_manager import LLMManager
from shared.user_config.user_config_manager import UserConfigManager
from shared.apis.dart_api import DartAPI
from shared.apis.telegram_api import TelegramBotClient
```

---

## ğŸ—“ï¸ Issue Scheduler Service ê°œë°œ ê°€ì´ë“œ

### **ğŸ“ ì„œë¹„ìŠ¤ ìœ„ì¹˜**

```
stock_analysis_service/services/issue_scheduler/
â”œâ”€â”€ __init__.py âœ…
â””â”€â”€ issue_scheduler.py âœ… (APIë§Œ êµ¬í˜„ë¨)
```

### **ğŸ¯ ê¸°ëŠ¥ ëª…ì„¸**

#### **1ï¸âƒ£ í•µì‹¬ ê¸°ëŠ¥**

**ğŸ“… ì´ìŠˆ ìº˜ë¦°ë” í¬ë¡¤ë§**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: get_upcoming_issues()
async def get_upcoming_issues(self, stock_codes: List[str], days_ahead: int = 30):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. FnGuide ìº˜ë¦°ë” í¬ë¡¤ë§ (https://comp.fnguide.com/SVO2/ASP/SVD_Corp.asp?pGB=1&gicode=A005930)
    2. ì¦ê¶Œì‚¬ ìº˜ë¦°ë” API ì—°ë™
    3. ì´ìŠˆ ìœ í˜•ë³„ ë¶„ë¥˜:
       - ìœ ìƒì¦ì/ë¬´ìƒì¦ì
       - ì‹¤ì ë°œí‘œ (ë¶„ê¸°/ì—°ê°„)
       - ì£¼ì£¼ì´íšŒ
       - ë°°ë‹¹ (ë°°ë‹¹ë½ì¼, ë°°ë‹¹ì§€ê¸‰ì¼)
       - ê³µëª¨ì£¼ ìƒì¥
       - ê¸°íƒ€ ì¤‘ìš” ì¼ì •
    """
```

**ğŸ¤– ì´ìŠˆ ì¤‘ìš”ë„ ë¶„ì„**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: analyze_issue_importance()
async def analyze_issue_importance(self, issue: Dict[str, Any]):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. LLM í”„ë¡¬í”„íŠ¸ ì„¤ê³„:
       - "ë‹¤ìŒ ê¸°ì—… ì´ìŠˆê°€ ì£¼ê°€ì— ë¯¸ì¹  ì˜í–¥ë„ë¥¼ 0-1ì ìœ¼ë¡œ í‰ê°€í•˜ì„¸ìš”"
       - ì´ìŠˆ ìœ í˜•, ê¸°ì—… ê·œëª¨, ê³¼ê±° ì‚¬ë¡€ ë“± ê³ ë ¤
    2. ì¤‘ìš”ë„ ì ìˆ˜ ê¸°ë°˜ ì•Œë¦¼ í•„í„°ë§ (0.7 ì´ìƒë§Œ ì•Œë¦¼)
    3. ê³¼ê±° ìœ ì‚¬ ì´ìŠˆ ì‚¬ë¡€ ê²€ìƒ‰ (VectorDB í™œìš©)
    """
```

**ğŸ”” ì•Œë¦¼ ì‹œìŠ¤í…œ**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: send_issue_alert()
async def send_issue_alert(self, user_id: str, issue: Dict[str, Any]):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. ì•Œë¦¼ ì‹œì :
       - D-3: ì‚¬ì „ ì•Œë¦¼ (ì‹¤ì ë°œí‘œ ë“±)
       - D-1: í•˜ë£¨ ì „ ì•Œë¦¼
       - D-day: ë‹¹ì¼ ì•„ì¹¨ ì•Œë¦¼
    2. ì•Œë¦¼ ë‚´ìš© í…œí”Œë¦¿:
       "ğŸ“… [ì‚¼ì„±ì „ì] ë‚´ì¼(1/30) 4ë¶„ê¸° ì‹¤ì ë°œí‘œ ì˜ˆì •
        ğŸ’¡ ì§€ë‚œ ë¶„ê¸° ëŒ€ë¹„ ì˜ˆìƒ ì‹¤ì : +15%
        ğŸ“Š ê³¼ê±° ì‹¤ì ë°œí‘œ í›„ í‰ê·  ì£¼ê°€ ë³€ë™: +3.2%"
    3. ë‹¤ì¤‘ ì±„ë„ ì§€ì›: í…”ë ˆê·¸ë¨, ì´ë©”ì¼, í‘¸ì‹œ
    """
```

#### **2ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**

```sql
-- ì´ìŠˆ ìº˜ë¦°ë” í…Œì´ë¸”
CREATE TABLE issue_calendar (
    id INT AUTO_INCREMENT PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    company_name VARCHAR(200) NOT NULL,
    event_type VARCHAR(50) NOT NULL, -- 'earnings', 'dividend', 'rights', 'meeting'
    event_date DATE NOT NULL,
    event_title VARCHAR(500) NOT NULL,
    description TEXT,
    importance_score DECIMAL(3,2), -- 0.00-1.00
    source VARCHAR(100), -- 'fnguide', 'securities_firm', 'dart'
    source_url TEXT,
    is_notified BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_stock_event_date (stock_code, event_date),
    INDEX idx_event_type (event_type),
    INDEX idx_importance_score (importance_score)
);

-- ì‚¬ìš©ì ì•Œë¦¼ ì„¤ì • í…Œì´ë¸”
CREATE TABLE user_issue_alert_settings (
    user_id VARCHAR(50) NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    event_types JSON, -- ['earnings', 'dividend'] ë“±
    alert_days_before JSON, -- [1, 3, 7] ë“±
    min_importance_score DECIMAL(3,2) DEFAULT 0.7,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (user_id, stock_code)
);
```

#### **3ï¸âƒ£ í¬ë¡¤ë§ êµ¬í˜„ ì˜ˆì‹œ**

```python
import asyncio
from selenium import webdriver
from selenium.webdriver.common.by import By
from bs4 import BeautifulSoup
import requests

async def crawl_fnguide_calendar(self, stock_codes: List[str]) -> List[Dict]:
    """FnGuide ì´ìŠˆ ìº˜ë¦°ë” í¬ë¡¤ë§"""

    # Selenium ì„¤ì •
    options = webdriver.ChromeOptions()
    options.add_argument('--headless')
    options.add_argument('--no-sandbox')

    driver = webdriver.Chrome(options=options)
    results = []

    try:
        for stock_code in stock_codes:
            url = f"https://comp.fnguide.com/SVO2/ASP/SVD_Corp.asp?pGB=1&gicode=A{stock_code}"
            driver.get(url)

            # ìº˜ë¦°ë” ì„¹ì…˜ íŒŒì‹±
            calendar_section = driver.find_element(By.CLASS_NAME, "calendar-section")

            # ì´ìŠˆ ì¶”ì¶œ ë¡œì§ êµ¬í˜„
            # ...

    finally:
        driver.quit()

    return results
```

#### **4ï¸âƒ£ API ì—”ë“œí¬ì¸íŠ¸ ì™„ì„±**

| ì—”ë“œí¬ì¸íŠ¸                          | êµ¬í˜„ ìƒíƒœ | TODO                     |
| ----------------------------------- | --------- | ------------------------ |
| `GET /issues/upcoming`              | ğŸ”´ ë¯¸êµ¬í˜„ | FnGuide í¬ë¡¤ë§ + DB ì¡°íšŒ |
| `POST /issues/analyze`              | ğŸ”´ ë¯¸êµ¬í˜„ | LLM ì¤‘ìš”ë„ ë¶„ì„          |
| `POST /alerts/send`                 | ğŸ”´ ë¯¸êµ¬í˜„ | í…”ë ˆê·¸ë¨/ì´ë©”ì¼ ë°œì†¡     |
| `GET /issues/calendar/{stock_code}` | ğŸ”´ ë¯¸êµ¬í˜„ | ì¢…ëª©ë³„ ìº˜ë¦°ë” ì¡°íšŒ       |

---

## ğŸ“Š Business Report Service ê°œë°œ ê°€ì´ë“œ

### **ğŸ“ ì„œë¹„ìŠ¤ ìœ„ì¹˜**

```
stock_analysis_service/services/business_report_service/
â”œâ”€â”€ __init__.py âœ…
â””â”€â”€ business_report_service.py âœ… (APIë§Œ êµ¬í˜„ë¨)
```

### **ğŸ¯ ê¸°ëŠ¥ ëª…ì„¸**

#### **1ï¸âƒ£ í•µì‹¬ ê¸°ëŠ¥**

**ğŸ“„ ì‚¬ì—…ë³´ê³ ì„œ ìˆ˜ì§‘**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: get_business_report()
async def get_business_report(self, stock_code: str, report_type: str = "annual"):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. DART API ì—°ë™:
       - ì •ê¸°ë³´ê³ ì„œ ëª©ë¡ ì¡°íšŒ: /api/list.json
       - ì‚¬ì—…ë³´ê³ ì„œ ì›ë¬¸: /api/document.json
    2. ë³´ê³ ì„œ ìœ í˜•ë³„ ì²˜ë¦¬:
       - annual: ì‚¬ì—…ë³´ê³ ì„œ (ì—°ê°„)
       - quarterly: ë¶„ê¸°ë³´ê³ ì„œ
       - semi: ë°˜ê¸°ë³´ê³ ì„œ
    3. í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° ì „ì²˜ë¦¬
    """

    # DART API í˜¸ì¶œ ì˜ˆì‹œ
    dart_api = self.dart_api

    # 1. ë³´ê³ ì„œ ëª©ë¡ ì¡°íšŒ
    reports = await dart_api.get_report_list(
        corp_code=stock_code,
        bsns_year="2024",
        reprt_code="11011"  # ì‚¬ì—…ë³´ê³ ì„œ
    )

    # 2. ìµœì‹  ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
    latest_report = reports[0]
    document = await dart_api.get_document(
        rcept_no=latest_report['rcept_no']
    )

    return document
```

**ğŸ¤– íˆ¬ì ê´€ì  íŠ¹í™” ìš”ì•½**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: summarize_report()
async def summarize_report(self, stock_code: str, report_data: Dict, user_id: str = None):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. LLM í”„ë¡¬í”„íŠ¸ ì„¤ê³„ (ê¸°íšì„œ ì°¸ì¡°):

    ë‹¹ì‹ ì€ ì£¼ì‹ ì• ë„ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ë‹¤ìŒ í…ìŠ¤íŠ¸ëŠ” ì‚¬ì—…ë³´ê³ ì„œì…ë‹ˆë‹¤.
    "ì£¼ê°€ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì •ë³´ë§Œ" ìš”ì•½í•´ ì£¼ì„¸ìš”.

    ìš”ì•½ í•­ëª©:
    1. ğŸ“¦ ì£¼ìš” ê³ ê°ì‚¬ ë° ê³„ì•½
       - (ê³ ê°ì‚¬ëª…)ê³¼ì˜ ìˆ˜ì£¼ ê³„ì•½ ì²´ê²°
       - ë‚©í’ˆì²˜, ë§¤ì¶œ ë¹„ì¤‘ ë“±

    2. ğŸš€ ì‹ ê·œ ì‚¬ì—… ë° íˆ¬ì
       - ì‹ ì‚¬ì—…(ì˜ˆ: AI/2ì°¨ì „ì§€ ë“±)
       - M&A, ê³µì¥ ì¦ì„¤, í•´ì™¸ ì§„ì¶œ ë“±

    3. âš ï¸ ë¦¬ìŠ¤í¬ ìš”ì¸
       - ì›ê°€ ìƒìŠ¹, ê·œì œ, ì†Œì†¡, ê¸°ìˆ  ì‹¤íŒ¨ ë“±

    4. ğŸ”® í–¥í›„ ê³„íš ë° ì‹¤ì  ì „ë§
       - íšŒì‚¬ì˜ ì‚¬ì—… ì „ëµ ìš”ì•½
       - í–¥í›„ ë§¤ì¶œ ì˜ˆìƒ, IR ê°€ì´ë˜ìŠ¤
    """

    # LLM ìš”ì•½ ì‹¤í–‰
    llm_client = await self.llm_manager.get_client_for_user(user_id)

    summary = await llm_client.generate_response(
        prompt=prompt,
        context=report_data['text']
    )

    return summary
```

**ğŸ“‹ PDF ë¦¬í¬íŠ¸ ìƒì„±**

```python
# TODO êµ¬í˜„ ìœ„ì¹˜: generate_report_pdf()
async def generate_report_pdf(self, stock_code: str, summary_data: Dict):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. reportlab ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
    2. í…œí”Œë¦¿ ë””ìì¸:
       - íšŒì‚¬ ë¡œê³ /ê¸°ë³¸ ì •ë³´
       - 4ê°œ ì„¹ì…˜ë³„ ì •ë¦¬
       - ì°¨íŠ¸/ê·¸ë˜í”„ ì‚½ì…
    3. íŒŒì¼ ì €ì¥ ë° ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ
    """

    from reportlab.pdfgen import canvas
    from reportlab.lib.pagesizes import A4

    # PDF ìƒì„± ë¡œì§
    pdf_path = f"reports/{stock_code}_business_report_{datetime.now().strftime('%Y%m%d')}.pdf"

    c = canvas.Canvas(pdf_path, pagesize=A4)

    # í—¤ë”
    c.drawString(100, 750, f"{summary_data['company_name']} ì‚¬ì—…ë³´ê³ ì„œ ìš”ì•½")

    # ê° ì„¹ì…˜ë³„ ë‚´ìš© ì¶”ê°€
    # ...

    c.save()
    return pdf_path
```

#### **2ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**

```sql
-- ì‚¬ì—…ë³´ê³ ì„œ ìš”ì•½ í…Œì´ë¸”
CREATE TABLE business_report_summaries (
    id INT AUTO_INCREMENT PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    company_name VARCHAR(200) NOT NULL,
    report_type VARCHAR(20) NOT NULL, -- 'annual', 'quarterly', 'semi'
    report_year YEAR NOT NULL,
    report_period VARCHAR(10), -- 'Q1', 'Q2', 'Q3', 'Q4' or NULL

    -- ìš”ì•½ ë‚´ìš© (JSON í˜•íƒœ)
    major_clients JSON,
    new_business JSON,
    risk_factors JSON,
    future_plans JSON,

    -- ë©”íƒ€ ì •ë³´
    dart_rcept_no VARCHAR(20),
    summary_generated_at TIMESTAMP,
    pdf_file_path VARCHAR(500),
    requested_by_user_id VARCHAR(50),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_stock_year (stock_code, report_year),
    INDEX idx_report_type (report_type),
    INDEX idx_user_requests (requested_by_user_id)
);

-- ì‚¬ìš©ì ì‚¬ì—…ë³´ê³ ì„œ ìš”ì²­ íˆìŠ¤í† ë¦¬
CREATE TABLE user_report_requests (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    report_type VARCHAR(20) NOT NULL,
    request_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    summary_id INT,

    FOREIGN KEY (summary_id) REFERENCES business_report_summaries(id)
);
```

#### **3ï¸âƒ£ DART API ì—°ë™**

```python
# DART API í´ë¼ì´ì–¸íŠ¸ í™•ì¥
class DartAPIExtended:

    async def get_report_list(self, corp_code: str, bsns_year: str, reprt_code: str):
        """ë³´ê³ ì„œ ëª©ë¡ ì¡°íšŒ"""
        url = "https://opendart.fss.or.kr/api/list.json"
        params = {
            'crtfc_key': self.api_key,
            'corp_code': corp_code,
            'bgn_de': f"{bsns_year}0101",
            'end_de': f"{bsns_year}1231",
            'reprt_code': reprt_code
        }

        async with aiohttp.ClientSession() as session:
            async with session.get(url, params=params) as response:
                return await response.json()

    async def get_document(self, rcept_no: str):
        """ë³´ê³ ì„œ ì›ë¬¸ ë‹¤ìš´ë¡œë“œ"""
        url = "https://opendart.fss.or.kr/api/document.json"
        params = {
            'crtfc_key': self.api_key,
            'rcept_no': rcept_no
        }

        # ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° í…ìŠ¤íŠ¸ ì¶”ì¶œ ë¡œì§
        # ...
```

#### **4ï¸âƒ£ API ì—”ë“œí¬ì¸íŠ¸ ì™„ì„±**

| ì—”ë“œí¬ì¸íŠ¸                             | êµ¬í˜„ ìƒíƒœ | TODO                    |
| -------------------------------------- | --------- | ----------------------- |
| `POST /reports/summarize/{stock_code}` | ğŸ”´ ë¯¸êµ¬í˜„ | DART API + LLM ìš”ì•½     |
| `GET /reports/{stock_code}`            | ğŸ”´ ë¯¸êµ¬í˜„ | ì›ë³¸ ë³´ê³ ì„œ ì¡°íšŒ        |
| `POST /reports/pdf/{stock_code}`       | ğŸ”´ ë¯¸êµ¬í˜„ | PDF ìƒì„± ë° ì €ì¥        |
| `GET /reports/history/{user_id}`       | ğŸ”´ ë¯¸êµ¬í˜„ | ì‚¬ìš©ì ìš”ì²­ íˆìŠ¤í† ë¦¬    |
| `GET /reports/available/{stock_code}`  | ğŸ”´ ë¯¸êµ¬í˜„ | ì‚¬ìš© ê°€ëŠ¥í•œ ë³´ê³ ì„œ ëª©ë¡ |

---

## ğŸ“ˆ Analysis Service ê°œë°œ ê°€ì´ë“œ

### **ğŸ“ ì„œë¹„ìŠ¤ ìœ„ì¹˜**

```
stock_analysis_service/services/analysis_service/
â”œâ”€â”€ __init__.py âœ…
â””â”€â”€ analysis_service.py âœ… (ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„ë¨, ë³´ì™„ í•„ìš”)
```

### **ğŸ¯ í˜„ì¬ ìƒíƒœ ë° ë³´ì™„ ì‚¬í•­**

#### **1ï¸âƒ£ ì´ë¯¸ êµ¬í˜„ëœ ê¸°ëŠ¥ âœ…**

- ì£¼ê°€ ê¸‰ë“±ë½ ê°ì§€ (10% ì´ìƒ + 1000ë§Œì£¼ ì´ìƒ)
- KIS API ì—°ë™í•œ ì‹¤ì‹œê°„ ì£¼ê°€ ì¡°íšŒ
- MySQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
- ê¸°ë³¸ API ì—”ë“œí¬ì¸íŠ¸ë“¤

#### **2ï¸âƒ£ ì¶”ê°€ êµ¬í˜„ í•„ìš”í•œ ê¸°ëŠ¥ ğŸ”´**

**ğŸ“Š ì°¨íŠ¸ í´ë¦­ ì‹œ ì›ì¸ ë¶„ì„ UI**

```python
# ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ í•„ìš”
@app.post("/explain/click-analysis")
async def explain_price_movement(
    stock_code: str,
    target_date: str,
    click_position: Dict[str, float]  # {x: timestamp, y: price}
):
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. í´ë¦­í•œ ë‚ ì§œì˜ ì£¼ê°€ ë°ì´í„° ë¶„ì„
    2. í•´ë‹¹ ë‚ ì§œ ì „í›„ ë‰´ìŠ¤/ê³µì‹œ/ì°¨íŠ¸ íŒ¨í„´ ê²€ìƒ‰
    3. ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€ ë§¤ì¹­ (VectorDB)
    4. LLMì„ í†µí•œ ì¢…í•© ì›ì¸ ë¶„ì„
    5. í”„ë¡ íŠ¸ì—”ë“œìš© ì‘ë‹µ í¬ë§·íŒ…
    """

    # 1. í•´ë‹¹ ë‚ ì§œ ì£¼ê°€ ë°ì´í„° ì¡°íšŒ
    price_data = await get_price_data(stock_code, target_date)

    # 2. ë‰´ìŠ¤/ê³µì‹œ ë°ì´í„° ê²€ìƒ‰
    news_data = await search_news_by_date(stock_code, target_date)
    disclosure_data = await search_disclosure_by_date(stock_code, target_date)

    # 3. ì°¨íŠ¸ íŒ¨í„´ ë¶„ì„
    chart_pattern = await analyze_chart_pattern(stock_code, target_date)

    # 4. ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€ ê²€ìƒ‰
    similar_cases = await search_similar_cases(price_data, news_data)

    # 5. LLM ì¢…í•© ë¶„ì„
    analysis_result = await llm_analyze_price_movement({
        'price_data': price_data,
        'news': news_data,
        'disclosure': disclosure_data,
        'chart_pattern': chart_pattern,
        'similar_cases': similar_cases
    })

    return {
        'status': 'success',
        'stock_code': stock_code,
        'target_date': target_date,
        'analysis': analysis_result,
        'evidence': {
            'news': news_data,
            'disclosure': disclosure_data,
            'chart_pattern': chart_pattern,
            'similar_cases': similar_cases
        }
    }
```

**ğŸ§  ì„¤ëª…ê°€ëŠ¥í•œ AI (XAI) ì•Œê³ ë¦¬ì¦˜**

```python
# ì˜µì…˜: GAAN ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
class ExplainableAI:
    """ì„¤ëª…ê°€ëŠ¥í•œ AI ì£¼ê°€ ë¶„ì„"""

    def __init__(self):
        # GAAN (Graph Attention Adversarial Network) ë˜ëŠ”
        # LIME (Local Interpretable Model-agnostic Explanations) êµ¬í˜„
        pass

    async def explain_price_movement(self, features: Dict) -> Dict:
        """
        êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
        1. ì£¼ê°€ ë³€ë™ ìš”ì¸ë³„ ì¤‘ìš”ë„ ì ìˆ˜ ê³„ì‚°
        2. ì‹œê°í™”ìš© ì–´í…ì…˜ ë§µ ìƒì„±
        3. ìš”ì¸ë³„ ê¸°ì—¬ë„ í¼ì„¼í…Œì´ì§€ ê³„ì‚°
        """

        # ìš”ì¸ë³„ ì¤‘ìš”ë„ ë¶„ì„
        importance_scores = {
            'news_sentiment': 0.35,      # ë‰´ìŠ¤ ê°ì • ì ìˆ˜
            'disclosure_impact': 0.25,   # ê³µì‹œ ì˜í–¥ë„
            'technical_indicators': 0.20, # ê¸°ìˆ ì  ì§€í‘œ
            'market_sentiment': 0.15,    # ì‹œì¥ ì „ì²´ ë¶„ìœ„ê¸°
            'trading_volume': 0.05       # ê±°ë˜ëŸ‰ íŒ¨í„´
        }

        return importance_scores
```

**ğŸ” ê³ ë„í™”ëœ ìœ ì‚¬ ì‚¬ë¡€ ê²€ìƒ‰**

```python
async def search_similar_cases_advanced(self, current_case: Dict) -> List[Dict]:
    """
    êµ¬í˜„í•´ì•¼ í•  ê²ƒ:
    1. ë‹¤ì°¨ì› ìœ ì‚¬ë„ ê³„ì‚°:
       - ì£¼ê°€ ë³€ë™ íŒ¨í„´ ìœ ì‚¬ë„ (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)
       - ë‰´ìŠ¤ ë‚´ìš© ìœ ì‚¬ë„ (ë²¡í„° ì„ë² ë”©)
       - ê±°ë˜ëŸ‰ íŒ¨í„´ ìœ ì‚¬ë„
       - ì‹œì¥ ìƒí™© ìœ ì‚¬ë„
    2. ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¢…í•© ìœ ì‚¬ë„ ì ìˆ˜
    3. ìƒìœ„ Nê°œ ìœ ì‚¬ ì‚¬ë¡€ ë°˜í™˜
    """

    # ë²¡í„° ê²€ìƒ‰
    vector_results = await self.vector_db.similarity_search(
        collection_name="price_analysis_vectors",
        query_vector=current_case['embedding'],
        top_k=10
    )

    # ì¶”ê°€ í•„í„°ë§ ë° ë­í‚¹
    filtered_results = []
    for result in vector_results:
        # ì‹œê°„ì  ê±°ë¦¬, ë³€ë™ë¥  ìœ ì‚¬ë„ ë“± ì¶”ê°€ ê³ ë ¤
        similarity_score = calculate_multi_dimensional_similarity(
            current_case, result
        )

        if similarity_score > 0.7:  # ì„ê³„ê°’
            filtered_results.append({
                'case': result,
                'similarity': similarity_score
            })

    return sorted(filtered_results, key=lambda x: x['similarity'], reverse=True)[:5]
```

#### **3ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™**

```typescript
// í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì°¨íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
interface ChartClickEvent {
  stock_code: string;
  timestamp: number;
  price: number;
  volume: number;
}

const handleChartClick = async (event: ChartClickEvent) => {
  try {
    const response = await fetch("/api/analysis/explain/click-analysis", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        stock_code: event.stock_code,
        target_date: new Date(event.timestamp).toISOString().split("T")[0],
        click_position: {
          x: event.timestamp,
          y: event.price,
        },
      }),
    });

    const analysis = await response.json();

    // ë¶„ì„ ê²°ê³¼ë¥¼ ëª¨ë‹¬ì´ë‚˜ ì‚¬ì´ë“œíŒ¨ë„ì— í‘œì‹œ
    showAnalysisModal(analysis);
  } catch (error) {
    console.error("ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨:", error);
  }
};
```

---

## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì„¤ì •

### **1ï¸âƒ£ í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜**

```bash
# ì¶”ê°€ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install selenium webdriver-manager beautifulsoup4
pip install reportlab PyPDF2 pdfplumber
pip install scikit-learn pandas numpy
pip install python-multipart python-jose[cryptography]
```

### **2ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

```bash
# .env íŒŒì¼ì— ì¶”ê°€
DART_API_KEY=your_dart_api_key
FNGUIDE_API_KEY=your_fnguide_api_key  # í•„ìš”ì‹œ
CHROME_DRIVER_PATH=/path/to/chromedriver
```

### **3ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì ìš©**

```bash
# MySQLì— ìƒˆ í…Œì´ë¸” ìƒì„±
python -c "
from services.issue_scheduler.issue_scheduler import IssueSchedulerService
from services.business_report_service.business_report_service import BusinessReportService
import asyncio

# ìŠ¤í‚¤ë§ˆ ìƒì„± ì‹¤í–‰
asyncio.run(create_new_schemas())
"
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### **1ï¸âƒ£ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**

```python
# test_issue_scheduler.py
import pytest
from services.issue_scheduler.issue_scheduler import IssueSchedulerService

@pytest.mark.asyncio
async def test_get_upcoming_issues():
    service = IssueSchedulerService()
    result = await service.get_upcoming_issues(['005930'], 30)

    assert result['status'] == 'success'
    assert isinstance(result['issues'], list)

# test_business_report.py
import pytest
from services.business_report_service.business_report_service import BusinessReportService

@pytest.mark.asyncio
async def test_summarize_report():
    service = BusinessReportService()
    result = await service.summarize_report('005930', {'text': 'test report'})

    assert result['status'] == 'success'
    assert 'summary' in result
```

### **2ï¸âƒ£ í†µí•© í…ŒìŠ¤íŠ¸**

```python
# test_integration.py
async def test_full_workflow():
    """ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""

    # 1. Issue Scheduler
    issues = await issue_scheduler.get_upcoming_issues(['005930'])
    assert len(issues['issues']) > 0

    # 2. Business Report
    summary = await business_report.summarize_report('005930', 'annual')
    assert summary['status'] == 'success'

    # 3. Analysis Service
    analysis = await analysis_service.analyze_price_movement('005930', '2024-01-15')
    assert analysis['status'] == 'success'
```

### **3ï¸âƒ£ API í…ŒìŠ¤íŠ¸**

```bash
# Issue Scheduler í…ŒìŠ¤íŠ¸
curl -X GET "http://localhost:8007/issues/upcoming?stock_codes=005930&days_ahead=30"

# Business Report í…ŒìŠ¤íŠ¸
curl -X POST "http://localhost:8008/reports/summarize/005930" \
  -H "Content-Type: application/json" \
  -d '{"user_id": "test_user", "report_type": "annual"}'

# Analysis Service í…ŒìŠ¤íŠ¸
curl -X POST "http://localhost:8009/explain/click-analysis" \
  -H "Content-Type: application/json" \
  -d '{"stock_code": "005930", "target_date": "2024-01-15", "click_position": {"x": 1705276800, "y": 75000}}'
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### **1ï¸âƒ£ ì™¸ë¶€ API ë¬¸ì„œ**

- [DART API ê°€ì´ë“œ](https://opendart.fss.or.kr/guide/main.do)
- [KIS API ë¬¸ì„œ](https://apiportal.koreainvestment.com/)
- [FnGuide ë°ì´í„° êµ¬ì¡°](https://comp.fnguide.com/)

### **2ï¸âƒ£ ê¸°ì¡´ ì½”ë“œ ì°¸ì¡°**

- `services/news_service/main.py` - í¬ë¡¤ë§ ë° LLM ì—°ë™ íŒ¨í„´
- `services/disclosure_service/disclosure_service.py` - DART API ì‚¬ìš©ë²•
- `shared/llm/llm_manager.py` - LLM í™œìš© ë°©ë²•

### **3ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ì°¸ì¡°**

- `database/complete_schema.sql` - ê¸°ì¡´ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°
- `shared/database/mysql_client.py` - DB ì—°ë™ ë°©ë²•

---

## âœ… ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### **Issue Scheduler Service**

- [ ] FnGuide í¬ë¡¤ë§ êµ¬í˜„
- [ ] ì´ìŠˆ ì¤‘ìš”ë„ LLM ë¶„ì„
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] API ë¬¸ì„œ ì‘ì„±

### **Business Report Service**

- [ ] DART API ì—°ë™ ì™„ì„±
- [ ] íˆ¬ì ê´€ì  ìš”ì•½ LLM êµ¬í˜„
- [ ] PDF ìƒì„± ê¸°ëŠ¥
- [ ] ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] API ë¬¸ì„œ ì‘ì„±

### **Analysis Service**

- [ ] ì°¨íŠ¸ í´ë¦­ ë¶„ì„ API ì¶”ê°€
- [ ] XAI ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„ (ì„ íƒì‚¬í•­)
- [ ] ìœ ì‚¬ ì‚¬ë¡€ ê²€ìƒ‰ ê³ ë„í™”
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ì¸í„°í˜ì´ìŠ¤
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [ ] ê¸°ì¡´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

---

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

### **1ï¸âƒ£ ê°œë°œ ì™„ë£Œ í›„ í™•ì¸ì‚¬í•­**

```bash
# 1. ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘ í™•ì¸
python start_all_services.py

# 2. í—¬ìŠ¤ì²´í¬ í™•ì¸
python check_services_health.py

# 3. í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python test_frontend_data_flow.py
```

### **2ï¸âƒ£ í”„ë¡œë•ì…˜ ë°°í¬**

- í™˜ê²½ë³€ìˆ˜ í™•ì¸ (`DART_API_KEY` ë“±)
- ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
- ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì„¤ì •
- ì—ëŸ¬ ì•Œë¦¼ ì„¤ì •

---

## ğŸ’¬ ë¬¸ì˜ì‚¬í•­

ê°œë°œ ì¤‘ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´:

1. ê¸°ì¡´ ì½”ë“œ êµ¬ì¡° ì°¸ì¡° (`services/` í´ë”ì˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤)
2. ê³µí†µ ëª¨ë“ˆ í™œìš© (`shared/` í´ë”)
3. API Gateway ì—°ë™ í™•ì¸
4. ë¡œê·¸ íŒŒì¼ í™•ì¸

**ğŸ¯ ì„±ê³µì ì¸ ê°œë°œì„ ìœ„í•´ ì´ ê°€ì´ë“œë¥¼ ë‹¨ê³„ë³„ë¡œ ë”°ë¼ ì§„í–‰í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤!**
